<!DOCTYPE html>

<head>
    <!--progress spinner-->
    <script type="text/javascript" charset="UTF-8" src="spinner.js"></script>
    <script type="text/javascript" charset="UTF-8" src="spinner.min.js"></script>
    
    <!--long tap-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.21/jquery-ui.min.js" type="text/javascript"></script>
    <script src="taphold.js" type="text/javascript"></script>
	
	<script type="text/javascript" charset="UTF-8" src="cordova.js"></script>

	<link rel="stylesheet" type="text/css" href="style.css">
	

	
	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
</head>
<style>
	td
	{
		overflow: hidden;
	}
		input[type="text"] 
	{
	    -webkit-box-sizing: border-box;
	    -moz-box-sizing: border-box;   
	    box-sizing: border-box;       
	}
</style>
<html>
	<body style="display: block;">
		<div id="SOSWrap" class="pageWrap">
			<h1 class="headerDecoration" style="font-size: 200%; border-bottom: none" >Send an SOS</h1>
			<form >
				<div>
					<div id="blank" style="height: 20%">
						
					</div>
					<div id="buttonSection" class="center" style="height: 60%">
						<img id="SOSButton" src='./images/btn_sos_normal.png' />
					</div>
					<div id="contacts">
						<div id="contactsSection" >
							<p class="headerDecoration">Contacts Circle</p>
										
							<table id="contactsList" style='font-size: 100%; width:100%'>

							</table>
							
							<table border="0" id='addingContactField' style='display:none; font-size: 100%; width:100%' >
								<tr>
									<td style="width:5%"><img src="./images/x.png" class="icons" onclick="CancelAdding(); return false" style="float: none"></td>
									<td style="width:45%">
										<div>
											<input type="text" id="contactName" class="inputBox" placeholder="Name" />	
										</div>
									</td>
									<td style="width:45%">
										<div>
											<input type="tel" id="contactNumber"  class="inputBox" placeholder="Number" />	
										</div>
									</td>
									<td style="width:5%"><img src="./images/plus.png"  class="icons" onclick="AddContact(); return false "   style="float: none">	</td>
								</tr>
							</table>	
							<div id="addbutton" style="display: inline; " >
								<input class="submitButtonStyle" type="submit" value="Add contact" style="width: 100%" onclick="ToggleDisplay('addingContactField','table'); ToggleDisplay('addbutton','inline'); return false" />
							</div>		
						</div>
	  				</div>
	  			</div>
			</form>
		</div>
		<script type="text/javascript" charset="UTF-8">
			$(function()
		    {

		        $("#SOSButton").on("taphold", {duration: 3000}, SOSLongPress)
		                  			.on("click",   SOSShortPress)
		                  			.on("touchstart", ChangeButtonToPressed)
									.on("touchend", ChangeButtonToNormal);
																
		    });
		    function ChangeButtonToPressed()
		    {
		    	button=document.getElementById("SOSButton");
				button.src='./images/btn_sos_pressed.png';
		    }
		    function ChangeButtonToNormal()
		    {
				button=document.getElementById("SOSButton");
				button.src='./images/btn_sos_normal.png';		    	
		    }
		    
			var i;
			var maxContacts=3;
			var contactsList=new Array(3);
			var contactsCounter=0;
			
			for (i=0;i<contactsList.length;++i)
			{
				contactsList[i]=new Array(2);
			}	
			
			function ToggleDisplay(id,arg)
			{
				var toggledID = document.getElementById(id);
				if (toggledID.style.display == 'none') 
				{
					toggledID.style.display = arg;
				} 
				else 
				{
					toggledID.style.display = 'none';
				}

			}
			
			function AddContact()
			{
				number=document.getElementById('contactNumber').value;
				if (isNumber(number))
				{
					name=document.getElementById('contactName').value;
					contactsList[contactsCounter][0]=name;
					contactsList[contactsCounter][1]=number;
	

					DisplaySingleContact(contactsCounter);												 
					contactsCounter++;
					
					ToggleDisplay('addingContactField','table'); 
					if (contactsCounter<maxContacts)
					{
						ToggleDisplay('addbutton','inline');
					}
					document.getElementById('contactNumber').value="";
					document.getElementById('contactName').value="";
				}
				else
				{
					alert("Please enter a valid Number.");
				}

			}
			
			function isNumber(n) 
			{
  				return !isNaN(parseFloat(n)) && isFinite(n);
			}
			
			function DisplaySingleContact(contactIndex)
			{
	
				
				document.getElementById('contactsList').innerHTML+= "<tr> <td style='width:5%'> <img src='./images/x.png' class='icons'  onclick='DeleteContact(" +contactIndex +"); return false' ></td>  <td style='width:47.5%'>"
																	+ contactsList[contactIndex][0] + "</td> <td  style='width:47.5%'> " + contactsList[contactIndex][1] + "</td> </tr>";
			}
			
			function DisplayContactList()
			{
				document.getElementById('contactsList').innerHTML="";
				for (i=0;i<contactsCounter;++i)
				{
					DisplaySingleContact(i);
				}
			}
			
			function CancelAdding()
			{
				ToggleDisplay('addingContactField','table'); 
				ToggleDisplay('addbutton','inline');
			}
			
			function DeleteContact(contactIndex)
			{
				var comfirmDeletion=confirm("Are you sure you want to remove this contact?");
				if (comfirmDeletion==true)
				{
					for (i=contactIndex; i<contactsCounter-1; ++i)
					{
	
						contactsList[i][0]=contactsList[i+1][0];
						contactsList[i][1]=contactsList[i+1][1];
					}
	
					if (contactsCounter==3)
					{
						ToggleDisplay('addbutton','inline');
					}
					--contactsCounter;
					DisplayContactList();
				}
			}
		function SOSLongPress()
		{
			spinner = new Spinner(HugeSpinnerOpts).spin(document.getElementById('buttonSection'));  
			navigator.geolocation.getCurrentPosition(onSuccess, onError);
			
			
			ChangeButtonToNormal();
			
		}
		
		function SOSShortPress()
		{

			alert("press 3 seconds");
			ChangeButtonToNormal();
			
		}
	    function onSuccess(position) 
	    {
	    	spinner.stop();
	    	alert(	"Coordinates:\n" +
	    			"Latitude: "	+ position.coords.latitude 	+ "\n" +
	    			"Longitude: "		+ position.coords.longitude + "\n\n" +
	    			"Your'e location has been sent to the local police.\n");
	    	

	    }
	
	    // onError Callback receives a PositionError object
	    //
	    function onError(error) 
	    {
	        alert(	'Sending location failed\n'	+
	        		'code: '    + error.code    + '\n' +
	              	'message: ' + error.message + '\n');
	    }
	    
	    
		var HugeSpinnerOpts = {
		  lines: 17, // The number of lines to draw
		  length: 40, // The length of each line
		  width: 14, // The line thickness
		  radius: 60, // The radius of the inner circle
		  corners: 1, // Corner roundness (0..1)
		  rotate: 0, // The rotation offset
		  direction: 1, // 1: clockwise, -1: counterclockwise
		  color: '#000', // #rgb or #rrggbb or array of colors
		  speed: 1, // Rounds per second
		  trail: 60, // Afterglow percentage
		  shadow: false, // Whether to render a shadow
		  hwaccel: false, // Whether to use hardware acceleration
		  className: 'spinner', // The CSS class to assign to the spinner
		  zIndex: 2e9, // The z-index (defaults to 2000000000)
		  top: 'auto', // Top position relative to parent in px
		  left: 'auto' // Left position relative to parent in px
		};
        var spinner;
        
		</script>
	</body>
</html>