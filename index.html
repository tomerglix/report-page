<!DOCTYPE html>

<head>
        <link rel="stylesheet" type="text/css" href="style.css">
        <!-- Include DropKick.css -->
        <link rel="stylesheet" href="./dropkick/dropkick.css">
        
        
        <!-- Include DropKick.js -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
        <script src="./dropkick/jquery.dropkick.js"></script>

        <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>                 
                
    	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    	<meta charset="utf-8">

		<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>   
        
	    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js">  </script> 
	    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"> </script>
	    <script type="text/javascript" src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.min.js"> </script>
	    <script type="text/javascript" src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.pt-BR.js"></script>
	    
    	<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
    	<link rel="stylesheet" type="text/css" media="screen" href="http://tarruda.github.com/bootstrap-datetimepicker/assets/css/bootstrap-datetimepicker.min.css">     
	    
        <title>Report Page</title>
</head>

<html>
	<body onload="PrintInitialDetails();" style="display: block" >
		<div id="reportPageWrap" class="pageWrap">
			
			<form >
				<input id='closeMapButton'  type='submit' onclick='ToggleMap(); return false; ' value='Close map' style="display: none; left:40%"  />        
	                        
				<div id="mapDisplay" style="display: none">
	                                
				</div>
				<div id="reportData">
					          <h1 class="headerDecoration" style="font-size: 200%; border-bottom: none" > Report Crime </h1>                                                              <!--main page header-->
	                                
	                          <div id="crimeType" >                                                                                                                                                        <!--crime type section-->
	                                  <div id="crimeTypeHeader">
	                                          <p  class="headerDecoration">Type</p>
	                                  </div>
	                                  <div id="crimeTypeSelection"  >
	                                        <select class="selectionList">
	                                                <option value="robbery">Robbery</option>
	                                                <option value="violence">Violence</option>
	                                                <option value="hijacking">Hijacking</option>
	                                                <option value="murder">Murder</option>
	                                                <option value="corruption">Corruption</option>
	                                                <option value="other">Other</option>
	                                        </select>
	                                        <br/><br/>
	                                  </div>
	                          
	                          </div>
	                          
	                          <div id="crimeDescription" >                                                                                                                                        <!--crime description section-->
	                                  <div id="crimeDescriptionHeader">
	                                          <p  class="headerDecoration" >Description</p>
	                                  </div>
	                                  <div id="crimeDescriptionBox" style="display: block; padding-right: 2%">
	                                          <textarea id="autoResizeTextBox" name="description" spellcheck="true" placeholder="Description" style="width:100%; "></textarea> 
	                                  </div>
	                          </div>
	
	
	                          <div id="crimeLocation" onclick="ViewLocationOnMap(); return false">                                                                                        <!--crime location section-->
	                                  <div id="crimeLocationHeader">
	                                          <p  class="headerDecoration">Location</p>
	                                  </div>
	                                  
	                                  <div id="crimeLocationData">
											<img src="./images/map-pin.png" class="icons" >
											<div id="addressBar">        
												<br/>
	    									</div>                
	                                  </div>
	                          </div>
	
	                          <div id="crimeDate" style="float:left">                                                                                                                                                        <!--crime date section-->
	                                  <div id="crimeDateHeader">
	                                          <p  class="headerDecoration">Date / Hour</p>
	                                  </div>
	                                  <div id="crimeDateData">
										    <div id="datetimepicker">
												<span class="add-on">
													<img src="./images/calendar.png" class="icons">
											        <input id="picker" type="text" />
											    </span>
										   	
										    </div>
	                                          
	                                  </div>
	                          </div>
	
	                          	<div id="crimePhotos">                                                                                                                                                        <!--crime photos section-->
									<div id="crimePhotosHeader">
		                                  <p  class="headerDecoration">Photos</p>
									</div>
		                   			<div id="crimePhotoAddButtons" onclick="ToggleDisplay('addPhotoButtons'); return false" style="display: inline;">
		                                 <img src="./images/camera.png" class="icons"  >         
									</div>
								  	<div id="addPhotoButtons" style="display:none">
									    <button id="captureButton" class="littleButtonStyle" onclick="capturePhoto(); return false" >Capture Photo</button> 
									    <button id="fromLibButton" class="littleButtonStyle" onclick="getPhoto(pictureSource.PHOTOLIBRARY); return false">Photo Library</button>
								    </div>
								    <div id="photosSection" >
									</div>
								</div>
	
							<div id="submitReportButton" style="display: block;">
								<input type="submit" id="submitCrimeButton" class="submitButtonStyle" onclick="SubmitCrime();  " style="width:100%;" value="Submit Crime" />                <!--maybe return false is needed-->
							</div>
				</div>
	
			</form>
		</div>


           
            <script type="text/javascript" charset="utf-8">
				function SubmitCrime()
				{

				}
                    //************* camera functions *********************/
                var pictureSource;   // picture source
                var destinationType; // sets the format of returned value
				var photoCounter=0;
				
                // Wait for device API libraries to load
                //
                document.addEventListener("deviceready",onDeviceReady,false);
            

                // device APIs are available
                //
                function onDeviceReady() 
                {
                    pictureSource=navigator.camera.PictureSourceType;
                    destinationType=navigator.camera.DestinationType;
                }
            
                // Called when a photo is successfully retrieved
                //
 				function getPhoto(source) 
				{
				      // Retrieve image file location from specified source
				      navigator.camera.getPicture(AddPhotoToFromLibrary, onFail, { quality: 50, 
				        destinationType: destinationType.FILE_URI,
				        sourceType: source });
				}  
				function capturePhoto() 
				{
				      // Take picture using device camera and retrieve image as base64-encoded string
				      navigator.camera.getPicture(AddPhotoToFromCaption, onFail, { quality: 50,
				        destinationType: destinationType.DATA_URL });
				}         
				function AddPhotoToFromCaption(imageData) 
				{
					var photoSection=document.getElementById('photosSection');
			
					photoSection.innerHTML+="<img style='display:inline;width:60px;height:60px;padding:4px;' id='img" + photoCounter + "' />";
			
					var smallImage = document.getElementById('img'+ photoCounter);
			
					smallImage.src = "data:image/jpeg;base64," + imageData;
					++photoCounter;
			
			    }
				function AddPhotoToFromLibrary(imageURI) 
				{
					var photoSection=document.getElementById('photosSection');
			
					photoSection.innerHTML+="<img style='display:inline;width:60px;height:60px;padding:4px;' id='img" + photoCounter + "' />";
			
					var smallImage = document.getElementById('img'+ photoCounter);
			
					smallImage.src = imageURI;
					++photoCounter;
			
			    }

            
                // Called if something bad happens.
                //
                function onFail(message) 
                {
                  alert('Failed because: ' + message);
                }
                //************* end of camera functions *********************/
               
                       //select list decoration
                    $(document).ready(function(){
                            $('.selectionList').dropkick();
                    });
                    
                    
                    //************ auto adjusting text box
                    $("#autoResizeTextBox").keyup(function (e) 
                    {
                        adaptiveheight(this);
                    });
                    i=0;
                    j=0;
                    
                    function adaptiveheight(a) 
                    {
                        $(a).height(0);
                        var scrollval = $(a)[0].scrollHeight;
                        $(a).height(scrollval);
                        if (parseInt(a.style.height) > $(window).height()) {
                            if(j==0){
                                max=a.selectionEnd;
                            }
                            j++;
                            var i =a.selectionEnd;
                            console.log(i);
                            if(i >=max){
                                $(document).scrollTop(parseInt(a.style.height));
                            }else{
                                $(document).scrollTop(0);
                            }
                        }
                    }
                    //************ end of auto adjusting text box
    
                    //************ beginning of finding city and country

                    function GetAddress(position)
                    {
                            var city = "";
                            var street = "";  
                            var streetNum = "";               
                            
                            lat = parseFloat(position.coords.latitude);
                        	lng = parseFloat(position.coords.longitude);
                        	var Latlng = new google.maps.LatLng(lat, lng);
                        	PrintAddressCoordinates(Latlng);



                    }
                    
                    function onError(error) 
                    {
                        alert(        'Sending location failed\n'        +
                                        'code: '    + error.code    + '\n' +
                                      'message: ' + error.message + '\n');
                    }        

                    //************ end of finding city and country
                    function PrintInitialDetails()
                    {                                
                            GetLocation(GetAddress);
                            PrintDate();
                    }
                    function GetLocation(functionWhenSuccess)
                    {
                            navigator.geolocation.getCurrentPosition(functionWhenSuccess, onError);
                    }
                    
                    function ViewLocationOnMap()
                    {
                            GetLocation(ShowMap);

                    }
                    
                    var map;
                    var marker;
                    var latlng;
                    var lastCenter="";
                    function ShowMap(position)
                    {

                    		if (lastCenter=="")
                    		{
                    			lastCenter=new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    		}

                            var mapOptions = 
                            {
                                	zoom: 15,
                                    center: lastCenter,
                                    mapTypeId:google.maps.MapTypeId.ROADMAP
                            };

                            map = new google.maps.Map(document.getElementById('mapDisplay'),mapOptions);
								
							ToggleMap();
							AddMarkerByCoordinates(lastCenter);
							
              
                    }
                    
                    function AddMarkerByCoordinates(latlng)
                    {
                    			marker = new google.maps.Marker({
							    position: latlng,
							    map: map,
							    draggable:true
							});
                    }
                    function ToggleMap()
                    {
                            mapID=document.getElementById('mapDisplay');                                
                            if (mapID.style.display=="none")
                            {     
                                    ToggleDisplay('mapDisplay');
                                    ToggleDisplay('reportData');
                                    ToggleDisplay('closeMapButton');
                                    lastCenter=map.getCenter(); 
                                    google.maps.event.trigger(map, 'resize');
                                    map.setCenter(lastCenter);
                            }
                            else	
                            {
                                    ToggleDisplay('mapDisplay');
                                    ToggleDisplay('reportData');
                                    ToggleDisplay('closeMapButton');
                                    
                                    //updates the city and country
									var lat = marker.getPosition().lat();
									var lng = marker.getPosition().lng();

									lastCenter = new google.maps.LatLng(lat, lng);
									PrintAddressCoordinates(lastCenter);
                            }
                            
                    }

                    
                    function ToggleDisplay(id)
                    {
                            var toggledID = document.getElementById(id);
                            if (toggledID.style.display == 'none') 
                            {
                                    toggledID.style.display = 'inline';
                            } 
                            else 
                            {
                                    toggledID.style.display = 'none';
                            }

                    }
                    
                    function PrintAddressCoordinates(latlng)
                    {
                    	geocoder = new google.maps.Geocoder();
                		geocoder.geocode( 
                			{'latLng': latlng}, 
							function(results, status) 
							{
							          
								if (status == google.maps.GeocoderStatus.OK) 
							    {
									if (results[0]) 
									{
										var result = results[0];
							
											for(var i=0, len=result.address_components.length; i<len; i++) 
											{
												var ac = result.address_components[i];
												if(ac.types.indexOf("street_number") >= 0) 
												{
													streetNum = ac.long_name;
												}
												if(ac.types.indexOf("route") >= 0) 
							                	{
							                        street = ac.long_name;
							                	}
												if(ac.types.indexOf("locality") >= 0) 
												{
													city = ac.long_name;	        
												}

							        		}
							
									}
									else 
									{
									        alert("Error in finding location");
									}
								} 
								else 
								{
									alert("Error: " + status);
								}
								addressBar=document.getElementById("addressBar");
							
								if (street!="")
								{
									addressBar.innerHTML=street;
									if (streetNum!="")
									{
								        addressBar.innerHTML+=" " + streetNum;
									}
									if (city!="")
									{
										addressBar.innerHTML+=", " + city;
									}
								
								}
								else
								{
									if (city!="")
									{
										addressBar.innerHTML=city;
									}
									else
									{
							        	cityCountry.innerHTML+="Unknown location <br/>";
							        }
								}
							  });
					}
					
					function PrintDate() 
				    {
				      navigator.globalization.dateToString(
				        new Date(),
				        function (date) 
				        {
				        	picker=document.getElementById('picker');
				        	picker.value=date.value;
				        },
				        function () {alert('Error getting dateString\n');},
				        {formatLength:'short', selector:'date and time'}
				      );
				    }

				      $('#datetimepicker').datetimepicker({
				        format: 'dd/MM/yyyy hh:mm',
				        language: 'en-us'
				      });
                </script>
        </body>
</html>