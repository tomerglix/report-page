<!DOCTYPE html>

<head>
        
        <!--cordova (phonegap api)-->   
        <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
        <!--google maps api--> 
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>                 
                
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
        <meta charset="utf-8">

        <!--progress spinner-->
        <script type="text/javascript" charset="UTF-8" src="spinner.js"></script>
        <script type="text/javascript" charset="UTF-8" src="spinner.min.js"></script>
        <!--roboto font-->
        <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>   
        
        <!--jquery-->
        <script type="text/javascript" src="jquery_1.10.2.js">  </script> 

            <!--date picker-->
        <script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"> </script>
        <script type="text/javascript" src="bootstrap_datetimepicker.min.js"> </script>
        <script type="text/javascript" src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.pt-BR.js"></script>            
        <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet" >
        <link rel="stylesheet" type="text/css" media="screen" href="http://tarruda.github.com/bootstrap-datetimepicker/assets/css/bootstrap-datetimepicker.min.css">     
    
         <!-- general style-->
         <link rel="stylesheet" type="text/css" href="style.css">
                 
        <title>Report Page</title>
        
        <style>


        </style>
</head>

<html>
        <body onload="PrintInitialDetails();" >
                <div id="reportPageWrap">
                	
                        <form >
                        	<div  class="pageWrap" style="margin-bottom: 10px">

                                <input id='closeMapButton' class="center" type='submit' onclick='ToggleMap(); return false; ' value='Close map' style="display: none; "  />        

                                <div id="mapDisplay" style="display: none">
                                        
                                </div>
                                <div id="reportData">
                           			  <h1 class="headerDecoration" style="font-size: 200%; border-bottom: none"> Report Crime </h1>                                                              <!--main page header-->
	                                        
	                                  <div id="crimeType" class="section">                                                                                                                                                        <!--crime type section-->
	                                          <div id="crimeTypeHeader">
	                                                  <p  class="headerDecoration">Type</p>
	                                          </div>
	                                          <div id="crimeTypeSelection" >
	                                                <select  style="width: 50%; margin-bottom:0;" class="robo">
	                                                        <option value="robbery">Robbery</option>
	                                                        <option value="violence">Violence</option>
	                                                        <option value="hijacking">Hijacking</option>
	                                                        <option value="murder">Murder</option>
	                                                        <option value="corruption">Corruption</option>
	                                                        <option value="other">Other</option>
	                                                </select>
	                                                <br/><br/>
	                                          </div>
	                                  
	                                  </div>
	                                  
	                                  <div id="crimeDescription" class="section">                                                                                                                                        <!--crime description section-->
	                                          <div id="crimeDescriptionHeader">
	                                                  <p  class="headerDecoration" >Description</p>
	                                          </div>
	                                          <div id="crimeDescriptionBox" class="robo">
	                                                  <textarea id="autoResizeTextBox" name="description" placeholder="Description"  style=" display: block"></textarea> 
	                                          </div>
	                                  </div>
        
        
	                                  <div id="crimeLocation" onclick="ViewLocationOnMap(); return false" class="section">                                                                                        <!--crime location section-->
	                                          <div id="crimeLocationHeader">
	                                                  <p  class="headerDecoration">Location</p>
	                                          </div>
	                                          
	                                          <div id="crimeLocationData">
													<img src="./images/map-pin.png" class="icons" >
													<div id="addressBar" class="robo">        
														<br/>   
													</div>  
													<br/>              
	                                          </div>
	                                  </div>
        
	                                  <div id="crimeDate" class="section" >                                                                                                                                                        <!--crime date section-->
	                                          <div id="crimeDateHeader" >
	                                                  <p  class="headerDecoration">Date &amp; Hour</p>
	                                          </div>
	                                          <div id="crimeDateData">
													<div id="datetimepicker">
															<span class="add-on">
													        	<img src="./images/calendar.png" class="icons">
													            <input id="picker" type="text" readonly />
													        </span>
													       
													</div>
													  
	                                          </div>
	                                  </div>
        
                                      <div id="crimePhotos" class="section">                                                                                       <!--crime photos section-->
                                            <div id="crimePhotosHeader">
                          						<p  class="headerDecoration">Photos</p>
                                            </div>
                                   			<div id="crimePhotoAddButtons" onclick="TogglePhotoButtons(); return false" style="display: inline;">
                         						<img src="./images/camera.png" class="icons"  >         
                                 			</div>
                                            <div id="addPhotoButtons" style="display:none; position: absolute; margin-left: 5px;" >
                                                    <button id="captureButton" class="littleButtonStyle" onclick="capturePhoto(); ToggleDisplay('addPhotoButtons'); return false" >Capture Photo</button> 
                                                    <button id="fromLibButton" class="littleButtonStyle" onclick="getPhoto(pictureSource.PHOTOLIBRARY); ToggleDisplay('addPhotoButtons'); return false">Photo Library</button>
                                            </div>
                                            <div id="photosSection" >
                                                    <br/> <br/> 
                                            </div>
									</div>
    
                                </div>
							</div>
							
                            <div id="submitReportButton" style="display: block;">
                                    <input type="submit" id="submitCrimeButton" class="submitButtonStyle" onclick="SubmitCrime();  " style="width:100%;" value="Submit Crime" />                <!--maybe return false is needed-->
                            </div>
        
                        </form>
                </div>


           
            <script type="text/javascript" charset="utf-8">
				var map;
                var marker;
                var latlng;
                var lastCenter="";
                var city = "";
                var street = "";  
                var streetNum = "";    
            	//******** general functions ************/
            	var spinner;
            	
                function SubmitCrime()
                {

                }
                
				function PrintInitialDetails()
                { 
	                var littleSpinner = new Spinner(smallSpinnerOpts).spin(document.getElementById('addressBar'));
	                GetLocation(GetAddress);
	                PrintDate();


                }

				function ToggleDisplay(id)
                {
                    var toggledID = document.getElementById(id);
                    if (toggledID.style.display == 'none') 
                    {
                            toggledID.style.display = 'inline';
                    } 
                    else 
                    {
                            toggledID.style.display = 'none';
                    }

                }
                
                function TogglePhotoButtons()
                {
                    if (photoCounter<maxPhotos)
                    {
                            ToggleDisplay('addPhotoButtons');
                    }
                    else
                    {
                            alert("You can only add " + maxPhotos + "photos.");                
                    }
                }
                
                //************* end of general functions **************/
                
                
                
                
            	//************* camera functions *********************/
                var pictureSource;   // picture source
                var destinationType; // sets the format of returned value
				var photoCounter=0;
				var maxPhotos=3;
                                
                // Wait for device API libraries to load
                //
                document.addEventListener("deviceready",onDeviceReady,false);
            

                // device APIs are available
                //
                function onDeviceReady() 
                {
                    pictureSource=navigator.camera.PictureSourceType;
                    destinationType=navigator.camera.DestinationType;
                }
            
                // Called when a photo is successfully retrieved
                //
                function getPhoto(source) 
                {
                      // Retrieve image file location from specified source
                      navigator.camera.getPicture(AddPhotoToFromLibrary, onFail, { quality: 50, 
                        destinationType: destinationType.FILE_URI,
                        sourceType: source });
                }  
                function capturePhoto() 
                {
                      // Take picture using device camera and retrieve image as base64-encoded string
                      navigator.camera.getPicture(AddPhotoToFromCaption, onFail, { quality: 50,
                        destinationType: destinationType.DATA_URL });
                }         
                function AddPhotoToFromCaption(imageData) 
                {
                    var photoSection=document.getElementById('photosSection');
    
                    photoSection.innerHTML+="<img style='display:inline;width:60px;height:60px;padding:4px;' id='img" + photoCounter + "' />";
    
                    var smallImage = document.getElementById('img'+ photoCounter);
    
                    smallImage.src = "data:image/jpeg;base64," + imageData;
                    ++photoCounter;
        
            	}
                function AddPhotoToFromLibrary(imageURI) 
                {
                    var photoSection=document.getElementById('photosSection');
    
                    photoSection.innerHTML+="<img style='display:inline;width:60px;height:60px;padding:4px;' id='img" + photoCounter + "' />";
    
                    var smallImage = document.getElementById('img'+ photoCounter);
    
                    smallImage.src = imageURI;
                    ++photoCounter;
        
            	}

            
                // Called if something bad happens.
                //
                function onFail(message) 
                {
                    if (message!='Camera cancelled.' && message!='Selection cancelled.')
                      {
                              alert('Failed because: ' + message);
                      }
                }
                //************* end of camera functions *********************/

                    
                //************ auto adjusting text box
                $("#autoResizeTextBox").keyup(function (e) 
                {
                    adaptiveheight(this);
                });
                
                
                i=0;
                j=0;
                
                function adaptiveheight(a) 
                {
                    $(a).height(0);
                    var scrollval = $(a)[0].scrollHeight;
                    $(a).height(scrollval);
                    if (parseInt(a.style.height) > $(window).height()) {
                        if(j==0){
                            max=a.selectionEnd;
                        }
                        j++;
                        var i =a.selectionEnd;
                        console.log(i);
                        if(i >=max){
                            $(document).scrollTop(parseInt(a.style.height));
                        }else{
                            $(document).scrollTop(0);
                        }
                    }
                }
                //************ end of auto adjusting text box

                //************ beginning location functions
        
                             
                function GetAddress(position)
                {
                    lat = parseFloat(position.coords.latitude);
                    lng = parseFloat(position.coords.longitude);
                    lastCenter = new google.maps.LatLng(lat, lng);
                    CoordinatesToStrings(lastCenter);
                    littleSpinner.stop();
                }
                
                function onError(error) 
                {
                    alert(        'Sending location failed\n'        +
                                    'code: '    + error.code    + '\n' +
                                  'message: ' + error.message + '\n');
                }      
                  
                function GetLocation(functionWhenSuccess)
                {
                    navigator.geolocation.getCurrentPosition(functionWhenSuccess, onError);
                }
                
                
                function ViewLocationOnMap()
                {
                    spinner = new Spinner(bigSpinnerOpts).spin(document.getElementById('reportPageWrap'));  
                    GetLocation(ShowMap);                           
                }

                function ShowMap(position)
                {

                    if (lastCenter=="")
                    {
                            lastCenter=new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    }

                    var mapOptions = 
                    {
                                zoom: 15,
                            center: lastCenter,
                            mapTypeId:google.maps.MapTypeId.ROADMAP
                    };

                    map = new google.maps.Map(document.getElementById('mapDisplay'),mapOptions);
                                                    
	                ToggleMap();
	                AddMarkerByCoordinates(lastCenter);
	                spinner.stop();
                }
                
                function AddMarkerByCoordinates(latlng)
                {
                    marker = new google.maps.Marker({
                                position: latlng,
                                map: map,
                                draggable:true
                            });
                }
                function ToggleMap()
                {
                    mapID=document.getElementById('mapDisplay');                                
                    if (mapID.style.display=="none")
                    {     
                        ToggleDisplay('mapDisplay');
                        ToggleDisplay('reportData');
                        ToggleDisplay('closeMapButton');
                        lastCenter=map.getCenter(); 
                        google.maps.event.trigger(map, 'resize');
                        map.setCenter(lastCenter);

                    }
                    else        
                    {
                        ToggleDisplay('mapDisplay');
                        ToggleDisplay('reportData');
                        ToggleDisplay('closeMapButton');
                        
                        //updates the city and country
                        var lat = marker.getPosition().lat();
                        var lng = marker.getPosition().lng();

                        lastCenter = new google.maps.LatLng(lat, lng);
                        CoordinatesToStrings(lastCenter);
                    }
                        
                }
				
                function CoordinatesToStrings(latlng)
                {
						
                        geocoder = new google.maps.Geocoder();
                        geocoder.geocode({'latLng': latlng}, 
                                        function(results, status) 
                                        {
                                                  
                                            if (status == google.maps.GeocoderStatus.OK) 
                                            {
                                                    if (results[0]) 
                                                    {
                                                        var result = results[0];
                                
                                                        for(var i=0, len=result.address_components.length; i<len; i++) 
                                                        {
                                                            var ac = result.address_components[i];
                                                            if(ac.types.indexOf("street_number") >= 0) 
                                                            {
                                                                streetNum = ac.long_name;
                                                                
                                                            }
                                                            if(ac.types.indexOf("route") >= 0) 
                                            				{
                                            					street = ac.long_name;
                                            					
                                            				}
                                                            if(ac.types.indexOf("locality") >= 0) 
                                                            {
                                                                city = ac.long_name;       
                                                                    
                                                            }
                                                		}
                                                		
                                                		addressBar=document.getElementById("addressBar");
                                        
											            if (street!="")
											            {
											                addressBar.innerHTML=street;
											                if (streetNum!="")
											                {
											                	addressBar.innerHTML+=" " + streetNum;
											                }
											                if (city!="")
											                {
											                    addressBar.innerHTML+=", " + city;
											                }
											            
											            }
											            else
											            {
											                if (city!="")
											                {
											                    addressBar.innerHTML=city;
											                }
											                else
											                {
											                	addressBar.innerHTML+="Unknown location <br/>";
											            	}
											            }		
                                    
                                                    }
                                                    else 
                                                    {
                                                        alert("Error in finding location");
                                                    }
                                                } 
                                                else 
                                                {
                                                    alert("Error: " + status);
                                                }
                                                
                                                
                                          });
                                                                                      				
                                          
				}
                                    
                //************ end of location functions
					function PrintDate() 
					{
                          navigator.globalization.dateToString(
                            new Date(),
                            function (date) 
                            { 
                        		dateString=date.day + '/' + date.month + '/' + date.year + " " + date.hour + ":" + date.minute + "tomer";
                        		alert(date);
                                picker=document.getElementById('picker');
                                picker.value=dateString;

                            },
                            function () {alert('Error getting dateString\n');},
                            {formatLength:'short', selector:'date and time'}
                          );
					}

					$('#datetimepicker').datetimepicker({
                    	format: 'dd/MM/yyyy hh:mm',
                    	language: 'en-us'
                 	});
                                      
                    $.fn.datetimepicker.defaults = 
                    {
                            maskInput: true,           // disables the text input mask
                            pickDate: true,            // disables the date picker
                            pickTime: true,            // disables de time picker
                            pick12HourFormat: false,   // enables the 12-hour format time picker
                            pickSeconds: false,         // disables seconds in the time picker
                            startDate: -Infinity,      // set a minimum date
                            endDate: Infinity          // set a maximum date
                    };
                    
                    //****************** spinner options *****************/
                    
                    var bigSpinnerOpts = 
                    {
                      	lines: 9, // The number of lines to draw
                      	length: 6, // The length of each line
                      	width: 4, // The line thickness
                      	radius: 7, // The radius of the inner circle
                      	corners: 1, // Corner roundness (0..1)
                      	rotate: 0, // The rotation offset
                      	direction: 1, // 1: clockwise, -1: counterclockwise
                      	color: '#000', // #rgb or #rrggbb or array of colors
                      	speed: 1, // Rounds per second
                      	trail: 44, // Afterglow percentage
                      	shadow: false, // Whether to render a shadow
                      	hwaccel: false, // Whether to use hardware acceleration
                      	className: 'spinner', // The CSS class to assign to the spinner
                      	zIndex: 2e9, // The z-index (defaults to 2000000000)
                      	top: 'auto', // Top position relative to parent in px
                      	left: 'auto' // Left position relative to parent in px
                    };
                    
                    var smallSpinnerOpts = 
                    {
						lines: 9, // The number of lines to draw
						length: 3, // The length of each line
						width: 2, // The line thickness
						radius: 3, // The radius of the inner circle
						corners: 1, // Corner roundness (0..1)
						rotate: 0, // The rotation offset
						direction: 1, // 1: clockwise, -1: counterclockwise
						color: '#000', // #rgb or #rrggbb or array of colors
						speed: 1, // Rounds per second
						trail: 60, // Afterglow percentage
						shadow: false, // Whether to render a shadow
						hwaccel: false, // Whether to use hardware acceleration
						className: 'spinner', // The CSS class to assign to the spinner
						zIndex: 2e9, // The z-index (defaults to 2000000000)
						top: 'auto', // Top position relative to parent in px
						left: 'auto' // Left position relative to parent in px
                    };
                                
                                                                        
            </script>
        </body>
</html>